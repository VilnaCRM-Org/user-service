resources:
  App\Shared\Application\DTO\EmptyResponse:
    exceptionToStatus:
      'App\User\Domain\Exception\UserTimedOutException': 429
      'App\User\Domain\Exception\UserNotFoundException': 404
      'App\User\Domain\Exception\InvalidPasswordException': 400
      'App\User\Domain\Exception\TokenNotFoundException': 404
      'App\User\Domain\Exception\DuplicateEmailException': 409
      'App\User\Domain\Exception\PasswordResetTokenNotFoundException': 404
      'App\User\Domain\Exception\PasswordResetTokenExpiredException': 400
      'App\User\Domain\Exception\PasswordResetTokenAlreadyUsedException': 400
      'App\User\Domain\Exception\PasswordResetTokenMismatchException': 400
      'App\User\Domain\Exception\PasswordResetRateLimitExceededException': 429
    operations:
      signin_http:
        class: ApiPlatform\Metadata\Post
        method: POST
        uriTemplate: '/signin'
        input: 'App\User\Application\DTO\SignInDto'
        processor: 'App\User\Application\Processor\SignInProcessor'
        read: false
        output: false
        openapi:
          summary: 'Sign in with email and password'
          description: 'Authenticates user credentials and returns access/refresh tokens or a pending 2FA session.'
          tags:
            - 'Authentication'
          responses:
            200:
              description: 'Sign-in succeeded'
            401:
              description: 'Invalid credentials'
            422:
              description: 'Validation error'
      signin_2fa_http:
        class: ApiPlatform\Metadata\Post
        method: POST
        uriTemplate: '/signin/2fa'
        input: 'App\User\Application\DTO\CompleteTwoFactorDto'
        processor: 'App\User\Application\Processor\CompleteTwoFactorProcessor'
        read: false
        output: false
        openapi:
          summary: 'Complete two-factor sign in'
          description: 'Validates pending 2FA session and TOTP code, then issues access and refresh tokens.'
          tags:
            - 'Authentication'
          responses:
            200:
              description: '2FA completed successfully'
            401:
              description: 'Invalid or expired 2FA session/code'
            422:
              description: 'Validation error'
      setup_2fa_http:
        class: ApiPlatform\Metadata\Post
        method: POST
        uriTemplate: '/users/2fa/setup'
        input: 'App\User\Application\DTO\SetupTwoFactorDto'
        processor: 'App\User\Application\Processor\SetupTwoFactorProcessor'
        read: false
        output: false
        openapi:
          summary: 'Set up two-factor authentication'
          description: 'Generates a TOTP secret and provisioning URI for the authenticated user.'
          tags:
            - 'Authentication'
          responses:
            200:
              description: '2FA setup payload generated'
            401:
              description: 'Authentication required'
      request_password_reset:
        class: ApiPlatform\Metadata\Post
        method: POST
        status: 204
        uriTemplate: '/reset-password'
        input: 'App\User\Application\DTO\RequestPasswordResetDto'
        controller: 'App\User\Application\Controller\RequestPasswordResetController'
        output: false
        read: false
        openapi:
          summary: 'Request a password reset'
          description: 'Initiates a password reset process by sending a reset token to the provided email address.'
          tags:
            - 'User reset password'
          responses:
            204:
              description: 'Password reset request accepted'
            400:
              description: 'Invalid request payload'
            404:
              description: 'User not found'
            422:
              description: 'Validation error'
            429:
              description: 'Password reset rate limit exceeded'
      confirm_password_reset:
        class: ApiPlatform\Metadata\Post
        method: POST
        status: 204
        uriTemplate: '/reset-password/confirm'
        input: 'App\User\Application\DTO\ConfirmPasswordResetDto'
        controller: 'App\User\Application\Controller\ConfirmPasswordResetController'
        output: false
        read: false
        openapi:
          summary: 'Confirm a password reset'
          description: 'Completes the password reset process by validating the reset token and setting a new password.'
          tags:
            - 'User reset password'
          responses:
            204:
              description: 'Password reset confirmed'
            400:
              description: 'Invalid or expired password reset token'
            404:
              description: 'Password reset token not found'
            422:
              description: 'Validation error'
